# 库存分配清零功能说明

## 功能概述

库存分配清零功能是清库下标系统的重要组成部分，支持两种清零方式：

1. **输入SKU清零**：通过输入SKU列表，对指定商品进行库存分配清零
2. **整店清零**：对整个店铺的所有SKU进行库存分配清零

## 功能特点

### 1. 分批处理机制
- 每个批次最多处理2000个SKU
- 当SKU数量超过2000时，自动分批处理
- 批次间默认间隔5分钟（可调整）

### 2. 两种清零方式

#### 输入SKU清零
- 支持手动输入SKU（换行、逗号、空格分隔）
- 支持TXT文件导入SKU列表
- 自动分批处理，每批最多2000个SKU
- 生成Excel文件上传到系统

#### 整店清零
- 一键清空整个店铺的所有SKU库存分配
- 直接调用API接口，无需生成Excel文件
- 操作前会显示警告提示

## 使用方法

### 1. 进入功能页面
1. 登录系统后，点击顶部标签页中的"库存分配清零"
2. 确保已选择正确的店铺

### 2. 输入SKU清零操作

#### 方式一：手动输入
1. 选择"输入SKU清零"选项
2. 在文本框中输入SKU，支持以下分隔方式：
   - 换行分隔
   - 逗号分隔
   - 空格分隔
3. 点击"添加任务"按钮
4. 系统会自动分批处理，每批最多2000个SKU

#### 方式二：文件导入
1. 选择"输入SKU清零"选项
2. 点击"选择文件"按钮
3. 选择包含SKU列表的TXT文件
4. 文件内容会自动加载到输入框
5. 点击"添加任务"按钮

### 3. 整店清零操作
1. 选择"整店清零"选项
2. 系统会显示警告信息
3. 确认无误后，点击"执行整店清零"按钮

### 4. 执行任务
1. 任务添加后，会在右侧任务列表中显示
2. 可以设置批次间隔时间（建议5分钟）
3. 点击"执行任务"按钮开始处理
4. 可以查看每个任务的执行状态和结果

## 技术实现

### 1. Excel文件格式
系统会生成符合要求的Excel文件，包含以下字段：
- 事业部编码
- 主商品编码
- 商家商品标识（SKU）
- 店铺编码
- 库存管理方式
- 库存比例/数值（清零时设为0）
- 仓库编号

### 2. API接口
- **SKU清零**：使用`/goodsStockConfig/importGoodsStockConfig.do`接口
- **整店清零**：使用`/inventory/clearStockAllocation.do`接口

### 3. 错误处理
- 5分钟频率限制检测
- 网络错误重试机制
- 详细的错误日志记录

## 注意事项

### 1. 安全提醒
- 整店清零操作会影响店铺内所有商品，请谨慎操作
- 建议在操作前备份重要数据

### 2. 频率限制
- 系统有5分钟的操作频率限制
- 如果遇到"5分钟内不要频繁操作"错误，请等待后重试

### 3. 批次处理
- 大量SKU会自动分批处理
- 每个批次独立执行，互不影响
- 可以查看每个批次的执行结果

### 4. 日志记录
- 所有操作都会记录详细日志
- 可以在任务列表中查看执行历史
- 支持导出操作日志

## 故障排除

### 1. 常见问题

#### 问题：提示"5分钟内不要频繁操作"
**解决方案**：等待5分钟后重试，或调整批次间隔时间

#### 问题：文件导入失败
**解决方案**：
- 确保文件格式为TXT
- 检查文件编码是否为UTF-8
- 确保文件内容不为空

#### 问题：任务执行失败
**解决方案**：
- 检查网络连接
- 确认登录状态有效
- 查看错误日志获取详细信息

### 2. 联系支持
如果遇到其他问题，请联系技术支持并提供以下信息：
- 错误截图
- 操作日志
- 系统版本信息

## 更新日志

### v1.0.0 (2024-01-XX)
- 初始版本发布
- 支持输入SKU清零和整店清零
- 实现分批处理机制
- 添加详细的日志记录 